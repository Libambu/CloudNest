import{k as O,r as _,al as f,o as i,c as m,a as t,Q as E,R as u,J as p,O as G,W as X,P as z,n as Y,a5 as H,I as T,M as D,D as j,E as K,u as J,w as le,L as ne}from"./@vue-d3a85cbd.js";import{u as Q,b as W}from"./vue-router-ca350b6a.js";import{S as re}from"./spark-md5-18b273be.js";import{_ as Z}from"./index-8cd997d5.js";import"./aplayer-d80f7f58.js";import"./element-plus-01fea8a5.js";import"./lodash-es-32f1e46b.js";import"./@vueuse-7b4dcecb.js";import"./@element-plus-8b4f8802.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-2cb15ffa.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-1ce37bfe.js";import"./vue-cookies-191b1cbf.js";import"./@highlightjs-a8dc01e9.js";import"./highlight.js-a76881e7.js";import"./axios-b5ee139b.js";import"./docx-preview-30c6d22b.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-a25062db.js";import"./vue-9c0dbc85.js";import"./dplayer-ff9c2365.js";import"./vue-clipboard3-abb1cd37.js";import"./clipboard-2fdbe17c.js";const ie={class:"avatar-upload"},ue={class:"avatar-show"},de=["src"],ce=["src"],pe=["src"],me={class:"select-btn"},_e={__name:"AvatarUpload",props:{modelValue:{type:Object,default:null}},setup(q,{emit:g}){O(),Q(),W(),_("");const P=_(null),$=g,w=async e=>{e=e.file;let h=new FileReader;h.readAsDataURL(e),h.onload=({target:R})=>{P.value=R.result},$("update:modelValue",e)};return(e,h)=>{const R=f("el-button"),U=f("el-upload");return i(),m("div",ie,[t("div",ue,[P.value?(i(),m("img",{key:0,src:P.value},null,8,de)):(i(),m(E,{key:1},[q.modelValue&&q.modelValue.qqAvatar?(i(),m("img",{key:0,src:`${q.modelValue.qqAvatar}`},null,8,ce)):(i(),m("img",{key:1,src:`/api/getAvatar/${q.modelValue.userId}`},null,8,pe))],64))]),t("div",me,[u(U,{name:"file","show-file-list":!1,accept:".png,.PNG,.jpg,.JPG,.jpeg,.JPEG,.gif,.GIF,.bmp,.BMP",multiple:!1,"http-request":w},{default:p(()=>[u(R,{type:"primary"},{default:p(()=>h[0]||(h[0]=[G("选择",-1)])),_:1,__:[0]})]),_:1})])])}}},ve={__name:"UpdateAvatar",emits:["updateAvatar"],setup(q,{expose:g,emit:P}){const{proxy:$}=O();Q(),W();const w={updateUserAvatar:"updateUserAvatar"},e=_({}),h=_();g({show:d=>{e.value=Object.assign({},d),e.value.avatar={userId:d.userId,qqAvatar:d.avatar},U.value.show=!0}});const U=_({show:!1,title:"修改头像",buttons:[{type:"primary",text:"确定",click:d=>{L()}}]}),V=P,L=async()=>{if(!(e.value.avatar instanceof File)){U.value.show=!1;return}if(!await $.Request({url:w.updateUserAvatar,params:{avatar:e.value.avatar}}))return;U.value.show=!1;const o=$.VueCookies.get("userInfo");delete o.avatar,$.VueCookies.set("userInfo",o,0),V("updateAvatar")};return(d,o)=>{const v=f("el-form-item"),M=f("el-form"),A=f("Dialog");return i(),m("div",null,[u(A,{show:U.value.show,title:U.value.title,buttons:U.value.buttons,width:"500px",showCancel:!0,onClose:o[2]||(o[2]=n=>U.value.show=!1)},{default:p(()=>[u(M,{model:e.value,ref_key:"formDataRef",ref:h,"label-width":"80px",onSubmit:o[1]||(o[1]=X(()=>{},["prevent"]))},{default:p(()=>[u(v,{label:"昵称",prop:""},{default:p(()=>[G(z(e.value.nickName),1)]),_:1}),u(v,{label:"头像",prop:""},{default:p(()=>[u(_e,{modelValue:e.value.avatar,"onUpdate:modelValue":o[0]||(o[0]=n=>e.value.avatar=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},fe={__name:"UpdatePassword",setup(q,{expose:g}){const{proxy:P}=O(),$={updatePassword:"updatePassword"},w=_({}),e=_(),h=(d,o,v)=>{o!==w.value.password?v(new Error(d.message)):v()},R={password:[{required:!0,message:"请输入密码"},{validator:P.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],rePassword:[{required:!0,message:"请再次输入密码"},{validator:h,message:"两次输入的密码不一致"}]};g({show:()=>{V.value.show=!0,Y(()=>{e.value.resetFields(),w.value={}})}});const V=_({show:!1,title:"修改密码",buttons:[{type:"primary",text:"确定",click:d=>{L()}}]}),L=async()=>{e.value.validate(async d=>{!d||!await P.Request({url:$.updatePassword,params:{password:w.value.password}})||(V.value.show=!1,P.Message.success("密码修改成功"))})};return(d,o)=>{const v=f("el-input"),M=f("el-form-item"),A=f("el-form"),n=f("Dialog");return i(),m("div",null,[u(n,{show:V.value.show,title:V.value.title,buttons:V.value.buttons,width:"500px",showCancel:!0,onClose:o[3]||(o[3]=a=>V.value.show=!1)},{default:p(()=>[u(A,{model:w.value,rules:R,ref_key:"formDataRef",ref:e,"label-width":"80px",onSubmit:o[2]||(o[2]=X(()=>{},["prevent"]))},{default:p(()=>[u(M,{label:"新密码",prop:"password"},{default:p(()=>[u(v,{type:"password",size:"large",placeholder:"请输入密码",modelValue:w.value.password,"onUpdate:modelValue":o[0]||(o[0]=a=>w.value.password=a),"show-password":""},{prefix:p(()=>o[4]||(o[4]=[t("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1}),u(M,{label:"确认密码",prop:"rePassword"},{default:p(()=>[u(v,{type:"password",size:"large",placeholder:"请再次输入密码",modelValue:w.value.rePassword,"onUpdate:modelValue":o[1]||(o[1]=a=>w.value.rePassword=a),"show-password":""},{prefix:p(()=>o[5]||(o[5]=[t("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}};const he={class:"uploader-panel"},we={class:"file-list"},ge={class:"file-item"},ye={class:"upload-panel"},ke={class:"file-name"},Ce={class:"progress"},be={class:"upload-status"},Se={key:0,class:"upload-info"},xe={class:"op"},Pe={class:"op-btn"},Ue={key:0},$e={key:0},N=1024*512,Fe={__name:"Uploader",emits:["uploadCallback"],setup(q,{expose:g,emit:P}){const{proxy:$}=O(),w={upload:"/file/uploadFile"},e={emptyfile:{value:"emptyfile",desc:"文件为空",color:"#F75000",icon:"close"},fail:{value:"fail",desc:"上传失败",color:"#F75000",icon:"close"},init:{value:"init",desc:"解析中",color:"#e6a23c",icon:"clock"},uploading:{value:"uploading",desc:"上传中",color:"#409eff",icon:"upload"},upload_finish:{value:"upload_finish",desc:"上传完成",color:"#67c23a",icon:"ok"},upload_seconds:{value:"upload_seconds",desc:"秒传",color:"#67c23a",icon:"ok"}},h=_([]),R=_([]);g({addFile:async(n,a)=>{const l={file:n,uid:n.uid,md5Progress:0,md5:null,fileName:n.name,status:e.init.value,uploadSize:0,totalSize:n.size,uploadProgress:0,pause:!1,chunkIndex:0,filePid:a,errorMsg:null};if(h.value.unshift(l),l.totalSize==0){l.status=e.emptyfile.value;return}let b=await M(l);b!=null&&v(b)}});const V=n=>{let a=A(n);a.pause=!1,v(n,a.chunkIndex)},L=n=>{let a=A(n);a.pause=!0},d=(n,a)=>{R.value.push(n),h.value.splice(a,1)},o=P,v=async(n,a)=>{a=a||0;let l=A(n);const b=l.file,y=l.totalSize,s=Math.ceil(y/N);for(let S=a;S<s;S++){let x=R.value.indexOf(n);if(x!=-1){R.value.splice(x,1);break}if(l=A(n),l.pause)break;let k=S*N,c=k+N>=y?y:k+N,r=b.slice(k,c),F=await $.Request({url:w.upload,showLoading:!1,dataType:"file",params:{file:r,fileName:b.name,fileMd5:l.md5,chunkIndex:S,chunks:s,fileId:l.fileId,filePid:l.filePid},showError:!1,errorCallback:I=>{l.status=e.fail.value,l.errorMsg=I},uploadProgressCallback:I=>{let B=I.loaded;B>y&&(B=y),l.uploadSize=S*N+B,l.uploadProgress=Math.floor(l.uploadSize/y*100)}});if(F==null)break;if(l.fileId=F.data.fileId,l.status=e[F.data.status].value,l.chunkIndex=S,F.data.status==e.upload_seconds.value||F.data.status==e.upload_finish.value){l.uploadProgress=100,o("uploadCallback");break}}},M=n=>{let a=n.file,l=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,b=Math.ceil(a.size/N),y=0,s=new re.ArrayBuffer,S=new FileReader;new Date().getTime();let x=()=>{let k=y*N,c=k+N>=a.size?a.size:k+N;S.readAsArrayBuffer(l.call(a,k,c))};return x(),new Promise((k,c)=>{let r=A(a.uid);S.onload=F=>{if(s.append(F.target.result),y++,y<b){let I=Math.floor(y/b*100);r.md5Progress=I,x()}else{let I=s.end();s.destroy(),r.md5Progress=100,r.status=e.uploading.value,r.md5=I,k(n.uid)}},S.onerror=()=>{r.md5Progress=-1,r.status=e.fail.value,k(n.uid)}}).catch(k=>null)},A=n=>h.value.find(l=>l.file.uid===n);return(n,a)=>{const l=f("el-progress"),b=f("icon"),y=f("NoData");return i(),m("div",he,[a[0]||(a[0]=t("div",{class:"uploader-title"},[t("span",null,"上传任务"),t("span",{class:"tips"},"（仅展示本次上传任务）")],-1)),t("div",we,[(i(!0),m(E,null,H(h.value,(s,S)=>(i(),m("div",ge,[t("div",ye,[t("div",ke,z(s.fileName),1),t("div",Ce,[s.status==e.uploading.value||s.status==e.upload_seconds.value||s.status==e.upload_finish.value?(i(),T(l,{key:0,percentage:s.uploadProgress},null,8,["percentage"])):D("",!0)]),t("div",be,[t("span",{class:j(["iconfont","icon-"+e[s.status].icon]),style:K({color:e[s.status].color})},null,6),t("span",{class:"status",style:K({color:e[s.status].color})},z(s.status=="fail"?s.errorMsg:e[s.status].desc),5),s.status==e.uploading.value?(i(),m("span",Se,z(J($).Utils.size2Str(s.uploadSize))+"/"+z(J($).Utils.size2Str(s.totalSize)),1)):D("",!0)])]),t("div",xe,[s.status==e.init.value?(i(),T(l,{key:0,type:"circle",width:50,percentage:s.md5Progress},null,8,["percentage"])):D("",!0),t("div",Pe,[s.status===e.uploading.value?(i(),m("span",Ue,[s.pause?(i(),T(b,{key:0,width:28,class:"btn-item",iconName:"upload",title:"上传",onClick:x=>V(s.uid)},null,8,["onClick"])):(i(),T(b,{key:1,width:28,class:"btn-item",iconName:"pause",title:"暂停",onClick:x=>L(s.uid)},null,8,["onClick"]))])):D("",!0),s.status!=e.init.value&&s.status!=e.upload_finish.value&&s.status!=e.upload_seconds.value?(i(),T(b,{key:1,width:28,class:"del btn-item",iconName:"del",title:"删除",onClick:x=>d(s.uid,S)},null,8,["onClick"])):D("",!0),s.status==e.upload_finish.value||s.status==e.upload_seconds.value?(i(),T(b,{key:2,width:28,class:"clean btn-item",iconName:"clean",title:"清除",onClick:x=>d(s.uid,S)},null,8,["onClick"])):D("",!0)])])]))),256)),h.value.length==0?(i(),m("div",$e,[u(y,{msg:"暂无上传任务"})])):D("",!0)])])}}},Re=Z(Fe,[["__scopeId","data-v-c4b41b7f"]]);const Ve={class:"framework"},Ae={class:"header"},Ie={class:"right-panel"},ze={class:"user-info"},De={class:"avatar"},Me={class:"nick-name"},Ne={class:"body"},qe={class:"left-sider"},Le={class:"menu-list"},Be=["onClick"],Te={class:"text"},je={class:"menu-sub-list"},Ee=["onClick"],Ge={class:"text"},Oe={key:0,class:"tips"},Je={class:"space-info"},He={class:"percent"},Qe={class:"space-use"},We={class:"use"},Ke={class:"body-content"},Xe={__name:"Framework",setup(q){const{proxy:g}=O(),P=Q(),$=W(),w={getUseSpace:"/getUseSpace",logout:"/logout"},e=_(!1),h=_(),R=c=>{const{file:r,filePid:F}=c;e.value=!0,h.value.addFile(r,F)},U=_(),V=()=>{Y(()=>{U.value.reload(),k()})},L=_(0),d=_(g.VueCookies.get("userInfo")),o=[{icon:"cloude",name:"首页",menuCode:"main",path:"/main/all",allShow:!0,children:[{icon:"all",name:"全部",category:"all",path:"/main/all"},{icon:"video",name:"视频",category:"video",path:"/main/video"},{icon:"music",name:"音频",category:"music",path:"/main/music"},{icon:"image",name:"图片",category:"image",path:"/main/image"},{icon:"doc",name:"文档",category:"doc",path:"/main/doc"},{icon:"more",name:"其他",category:"others",path:"/main/others"}]},{path:"/myshare",icon:"share",name:"分享",menuCode:"share",allShow:!0,children:[{name:"分享记录",path:"/myshare"}]},{path:"/recycle",icon:"del",name:"回收站",menuCode:"recycle",tips:"回收站为你保存10天内删除的文件",allShow:!0,children:[{name:"删除的文件",path:"/recycle"}]},{path:"/settings/fileList",icon:"settings",name:"设置",menuCode:"settings",allShow:!1,children:[{name:"用户文件",path:"/settings/fileList"},{name:"用户管理",path:"/settings/userList"},{path:"/settings/sysSetting",name:"系统设置"}]}],v=_({}),M=_(),A=c=>{!c.path||c.menuCode==v.value.menuCode||P.push(c.path)},n=(c,r)=>{const F=o.find(I=>I.menuCode===c);v.value=F,M.value=r};le(()=>$,(c,r)=>{c.meta.menuCode&&n(c.meta.menuCode,c.path)},{immediate:!0,deep:!0});const a=_(),l=()=>{a.value.show(d.value)},b=()=>{d.value=g.VueCookies.get("userInfo"),L.value=new Date().getTime()},y=_(),s=()=>{y.value.show()},S=()=>{g.Confirm("你确定要删除退出吗",async()=>{await g.Request({url:w.logout})&&(g.VueCookies.remove("userInfo"),P.push("/login"))})},x=_({useSpace:0,totalSpace:1}),k=async()=>{let c=await g.Request({url:w.getUseSpace,showLoading:!1});c&&(x.value=c.data)};return k(),(c,r)=>{const F=f("el-popover"),I=f("Avatar"),B=f("el-dropdown-item"),ee=f("el-dropdown-menu"),te=f("el-dropdown"),se=f("el-progress"),ae=f("router-view");return i(),m("div",Ve,[t("div",Ae,[r[5]||(r[5]=t("div",{class:"logo"},[t("span",{class:"iconfont icon-pan"}),t("span",{class:"name"},"Easy云盘")],-1)),t("div",Ie,[u(F,{width:800,trigger:"click",visible:e.value,"onUpdate:visible":r[0]||(r[0]=C=>e.value=C),offset:20,transition:"none","hide-after":0,"popper-style":{padding:"0px"}},{reference:p(()=>r[1]||(r[1]=[t("span",{class:"iconfont icon-transfer"},null,-1)])),default:p(()=>[u(Re,{ref_key:"uploaderRef",ref:h,onUploadCallback:V},null,512)]),_:1},8,["visible"]),u(te,null,{dropdown:p(()=>[u(ee,null,{default:p(()=>[u(B,{onClick:l},{default:p(()=>r[2]||(r[2]=[G(" 修改头像 ",-1)])),_:1,__:[2]}),u(B,{onClick:s},{default:p(()=>r[3]||(r[3]=[G(" 修改密码 ",-1)])),_:1,__:[3]}),u(B,{onClick:S},{default:p(()=>r[4]||(r[4]=[G(" 退出 ",-1)])),_:1,__:[4]})]),_:1})]),default:p(()=>[t("div",ze,[t("div",De,[u(I,{userId:d.value.userId,avatar:d.value.avatar,timestamp:L.value,width:46},null,8,["userId","avatar","timestamp"])]),t("span",Me,z(d.value.nickName),1)])]),_:1})])]),t("div",Ne,[t("div",qe,[t("div",Le,[(i(),m(E,null,H(o,C=>(i(),m(E,null,[C.allShow||!C.allShow&&d.value.admin?(i(),m("div",{key:0,onClick:oe=>A(C),class:j(["menu-item",C.menuCode==v.value.menuCode?"active":""])},[t("div",{class:j(["iconfont","icon-"+C.icon])},null,2),t("div",Te,z(C.name),1)],10,Be)):D("",!0)],64))),64))]),t("div",je,[(i(!0),m(E,null,H(v.value.children,C=>(i(),m("div",{onClick:oe=>A(C),class:j(["menu-item-sub",M.value==C.path?"active":""])},[C.icon?(i(),m("span",{key:0,class:j(["iconfont","icon-"+C.icon])},null,2)):D("",!0),t("span",Ge,z(C.name),1)],10,Ee))),256)),v.value&&v.value.tips?(i(),m("div",Oe,z(v.value.tips),1)):D("",!0),t("div",Je,[r[6]||(r[6]=t("div",null,"空间使用",-1)),t("div",He,[u(se,{percentage:Math.floor(x.value.useSpace/x.value.totalSpace*1e4)/100,color:"#409eff"},null,8,["percentage"])]),t("div",Qe,[t("div",We,z(J(g).Utils.size2Str(x.value.useSpace))+"/ "+z(J(g).Utils.size2Str(x.value.totalSpace)),1),t("div",{class:"iconfont icon-refresh",onClick:k})])])])]),t("div",Ke,[u(ae,null,{default:p(({Component:C})=>[(i(),T(ne(C),{onAddFile:R,ref_key:"routerViewRef",ref:U,onReload:k},null,544))]),_:1})])]),u(ve,{ref_key:"updateAvatarRef",ref:a,onUpdateAvatar:b},null,512),u(fe,{ref_key:"updatePasswordRef",ref:y},null,512)])}}},Pt=Z(Xe,[["__scopeId","data-v-832ae474"]]);export{Pt as default};
