import{u as Z,b as ee}from"./vue-router-ca350b6a.js";import{_ as se}from"./index-8cd997d5.js";import{k as ae,r,al as c,ar as te,o,c as d,a as s,K as oe,Q as x,R as v,P as _,I as m,J as k,u as D,O as M,M as y}from"./@vue-d3a85cbd.js";import"./element-plus-01fea8a5.js";import"./lodash-es-32f1e46b.js";import"./@vueuse-7b4dcecb.js";import"./@element-plus-8b4f8802.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-2cb15ffa.js";import"./aplayer-d80f7f58.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-1ce37bfe.js";import"./vue-cookies-191b1cbf.js";import"./@highlightjs-a8dc01e9.js";import"./highlight.js-a76881e7.js";import"./axios-b5ee139b.js";import"./docx-preview-30c6d22b.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-a25062db.js";import"./vue-9c0dbc85.js";import"./dplayer-ff9c2365.js";import"./vue-clipboard3-abb1cd37.js";import"./clipboard-2fdbe17c.js";const ne={class:"share"},le={class:"share-body"},ie={key:0,class:"loading"},re={class:"share-panel"},ce={class:"share-user-info"},de={class:"avatar"},ue={class:"share-info"},pe={class:"user-info"},he={class:"nick-name"},fe={class:"share-time"},ve={class:"file-name"},_e={class:"share-op-btn"},me={class:"file-list"},ye=["onMouseenter","onMouseleave"],ge=["title"],Se=["onClick"],ke={class:"op"},Ie=["onClick"],we=["onClick"],Ce={key:0},be={__name:"Share",setup(Fe){const{proxy:n}=ae(),p=Z(),I=ee(),u={getShareLoginInfo:"/showShare/getShareLoginInfo",loadFileList:"/showShare/loadFileList",createDownloadUrl:"/showShare/createDownloadUrl",download:"/api/showShare/download",cancelShare:"/share/cancelShare",saveShare:"/showShare/saveShare"},i=I.params.shareId,l=r({});(async()=>{let e=await n.Request({url:u.getShareLoginInfo,showLoading:!1,params:{shareId:i}});if(e){if(e.data==null){p.push("/shareCheck/"+i);return}l.value=e.data}})();const P=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],h=r({}),O={extHeight:80,selectType:"checkbox"},w=async()=>{let e={pageNo:h.value.pageNo,pageSize:h.value.pageSize,shareId:i,filePid:F.value.fileId},a=await n.Request({url:u.loadFileList,params:e});a&&(h.value=a.data)},z=e=>{h.value.list.forEach(a=>{a.showOp=!1}),e.showOp=!0},L=e=>{e.showOp=!1},f=r([]),U=e=>{f.value=[],e.forEach(a=>{f.value.push(a.fileId)})},F=r({fileId:0}),V=e=>{const{curFolder:a}=e;F.value=a,w()},N=r(),T=r(),q=e=>{if(e.folderType==1){T.value.openFolder(e);return}e.shareId=i,N.value.showPreview(e,2)},$=async e=>{let a=await n.Request({url:u.createDownloadUrl+"/"+i+"/"+e});a&&(window.location.href=u.download+"/"+a.data)},g=r(),C=[],j=()=>{if(f.value.length!=0){if(!n.VueCookies.get("userInfo")){p.push("/login?redirectUrl="+I.path);return}C.values=f.value,g.value.showFolderDialog()}},B=e=>{if(!n.VueCookies.get("userInfo")){p.push("/login?redirectUrl="+I.path);return}C.values=[e.fileId],g.value.showFolderDialog()},E=async e=>{await n.Request({url:u.saveShare,params:{shareId:i,shareFileIds:C.values.join(","),myFolderId:e}})&&(w(),n.Message.success("保存成功"),g.value.close())},A=()=>{n.Confirm("你确定要取消分享吗？",async()=>{await n.Request({url:u.cancelShare,params:{shareIds:i}})&&(n.Message.success("取消分享成功"),p.push("/"))})},H=()=>{p.push("/")};return(e,a)=>{const J=c("Avatar"),R=c("el-button"),K=c("Navigation"),b=c("icon"),Q=c("Table"),G=c("FolderSelect"),W=c("Preview"),X=te("loading");return o(),d("div",ne,[s("div",{class:"header"},[s("div",{class:"header-content"},[s("div",{class:"logo",onClick:H},a[0]||(a[0]=[s("span",{class:"iconfont icon-pan"},null,-1),s("span",{class:"name"},"Easy云盘",-1)]))])]),s("div",le,[Object.keys(l.value).length==0?oe((o(),d("div",ie,null,512)),[[X,Object.keys(l.value).length==0]]):(o(),d(x,{key:1},[s("div",re,[s("div",ce,[s("div",de,[v(J,{userId:l.value.userId,avatar:l.value.avatar,width:50},null,8,["userId","avatar"])]),s("div",ue,[s("div",pe,[s("span",he,_(l.value.nickName),1),s("span",fe,"分享于 "+_(l.value.shareTime),1)]),s("div",ve,"分享文件："+_(l.value.fileName),1)])]),s("div",_e,[l.value.currentUser?(o(),m(R,{key:0,type:"primary",onClick:A},{default:k(()=>a[1]||(a[1]=[s("span",{class:"iconfont icon-cancel"},null,-1),M("取消分享",-1)])),_:1,__:[1]})):(o(),m(R,{key:1,type:"primary",disabled:f.value.length==0,onClick:j},{default:k(()=>a[2]||(a[2]=[s("span",{class:"iconfont icon-import"},null,-1),M("保存到我的网盘",-1)])),_:1,__:[2]},8,["disabled"]))])]),v(K,{ref_key:"navigationRef",ref:T,onNavChange:V,shareId:D(i)},null,8,["shareId"]),s("div",me,[v(Q,{columns:P,showPagination:!0,dataSource:h.value,fetch:w,initFetch:!1,options:O,showPageSize:!1,onRowSelected:U},{fileName:k(({index:Y,row:t})=>[s("div",{class:"file-item",onMouseenter:S=>z(t),onMouseleave:S=>L(t)},[(t.fileType==3||t.fileType==1)&&t.status!==0?(o(),m(b,{key:0,cover:t.fileCover},null,8,["cover"])):(o(),d(x,{key:1},[t.folderType==0?(o(),m(b,{key:0,fileType:t.fileType},null,8,["fileType"])):y("",!0),t.folderType==1?(o(),m(b,{key:1,fileType:0})):y("",!0)],64)),s("span",{class:"file-name",title:t.fileName},[s("span",{onClick:S=>q(t)},_(t.fileName),9,Se)],8,ge),s("span",ke,[t.folderType==0?(o(),d("span",{key:0,class:"iconfont icon-download",onClick:S=>$(t.fileId)},"下载",8,Ie)):y("",!0),t.showOp&&!l.value.currentUser?(o(),d("span",{key:1,class:"iconfont icon-import",onClick:S=>B(t)},"保存到我的网盘",8,we)):y("",!0)])],40,ye)]),fileSize:k(({index:Y,row:t})=>[t.fileSize?(o(),d("span",Ce,_(D(n).Utils.size2Str(t.fileSize)),1)):y("",!0)]),_:1},8,["dataSource"])])],64)),v(G,{ref_key:"folderSelectRef",ref:g,onFolderSelect:E},null,512),v(W,{ref_key:"previewRef",ref:N},null,512)])])}}},ss=se(be,[["__scopeId","data-v-80700666"]]);export{ss as default};
