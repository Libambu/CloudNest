import{k as F,r as g,l as O,Y as K,al as k,o as m,c as _,a as s,R as r,J as o,n as D,I as b,M as p,O as q,a6 as J,W,P as Y}from"./@vue-d3a85cbd.js";import{u as A,b as G}from"./vue-router-ca350b6a.js";import{m as H}from"./js-md5-cda431b7.js";import{_ as Q}from"./index-8cd997d5.js";import"./aplayer-d80f7f58.js";import"./element-plus-01fea8a5.js";import"./lodash-es-32f1e46b.js";import"./@vueuse-7b4dcecb.js";import"./@element-plus-8b4f8802.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-2cb15ffa.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-1ce37bfe.js";import"./vue-cookies-191b1cbf.js";import"./@highlightjs-a8dc01e9.js";import"./highlight.js-a76881e7.js";import"./axios-b5ee139b.js";import"./docx-preview-30c6d22b.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-a25062db.js";import"./vue-9c0dbc85.js";import"./dplayer-ff9c2365.js";import"./vue-clipboard3-abb1cd37.js";import"./clipboard-2fdbe17c.js";const X="/assets/qq-8fddb348.png";const Z={class:"login-body"},ee={class:"login-panel"},oe={key:1},se={class:"send-emali-panel"},le={class:"check-code-panel"},te=["src"],ae={class:"rememberme-panel"},re={class:"no-account"},ie={key:0},ne={key:1},de={key:2},ue={key:5,class:"login-btn-qq"},me={class:"check-code-panel"},pe=["src"],ce={__name:"Login",setup(fe){const{proxy:u}=F(),L=A(),P=G(),c={checkCode:"/api/checkCode",sendMailCode:"/sendEmailCode",register:"/register",login:"/login",resetPwd:"/resetPwd",qqlogin:"/qqlogin"},t=g(1),f=i=>{t.value=i,j()};O(()=>{f(1)});const N=(i,e,n)=>{e!==a.value.registerPassword?n(new Error(i.message)):n()},a=g({}),M=g(),R={email:[{required:!0,message:"请输入邮箱"},{validator:u.Verify.email,message:"请输入正确的邮箱"}],password:[{required:!0,message:"请输入密码"}],emailCode:[{required:!0,message:"请输入邮箱验证码"}],nickName:[{required:!0,message:"请输入昵称"}],registerPassword:[{required:!0,message:"请输入密码"},{validator:u.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],reRegisterPassword:[{required:!0,message:"请再次输入密码"},{validator:N,message:"两次输入的密码不一致"}],checkCode:[{required:!0,message:"请输入图片验证码"}]},U=g(),I=g(),w=i=>{i==0?U.value=c.checkCode+"?type="+i+"&time="+new Date().getTime():I.value=c.checkCode+"?type="+i+"&time="+new Date().getTime()},y=g({}),x=g(),C=K({show:!1,title:"发送邮箱验证码",buttons:[{type:"primary",text:"发送验证码",click:()=>{$()}}]}),S=()=>{M.value.validateField("email",i=>{i&&(C.show=!0,D(()=>{w(1),x.value.resetFields(),y.value={email:a.value.email}}))})},$=()=>{x.value.validate(async i=>{if(!i)return;const e=Object.assign({},y.value);e.type=t.value==0?0:1,await u.Request({url:c.sendMailCode,params:e,errorCallback:()=>{w(1)}})&&(u.Message.success("验证码发送成功，请登录邮箱查看"),C.show=!1)})},j=()=>{D(()=>{if(w(0),M.value.resetFields(),a.value={},t.value==1){const i=u.VueCookies.get("loginInfo");i&&(a.value=i)}})},h=()=>{M.value.validate(async i=>{if(!i)return;let e={};if(Object.assign(e,a.value),(t.value==0||t.value==2)&&(e.password=e.registerPassword,delete e.registerPassword,delete e.reRegisterPassword),t.value==1){let v=u.VueCookies.get("loginInfo"),V=v==null?null:v.password;e.password!==V&&(e.password=H(e.password))}let n=null;t.value==0?n=c.register:t.value==1?n=c.login:t.value==2&&(n=c.resetPwd);let d=await u.Request({url:n,params:e,errorCallback:()=>{w(0)}});if(d)if(t.value==0)u.Message.success("注册成功,请登录"),f(1);else if(t.value==1){if(e.rememberMe){const V={email:e.email,password:e.password,rememberMe:e.rememberMe};u.VueCookies.set("loginInfo",V,"7d")}else u.VueCookies.remove("loginInfo");u.Message.success("登录成功"),u.VueCookies.set("userInfo",d.data,0);const v=P.query.redirectUrl||"/";L.push(v)}else t.value==2&&(u.Message.success("重置密码成功,请登录"),f(1))})},E=async()=>{let i=await u.Request({url:c.qqlogin,params:{callbackUrl:P.query.redirectUrl||""}});i&&(u.VueCookies.remove("userInfo"),document.location.href=i.data)};return(i,e)=>{const n=k("el-input"),d=k("el-form-item"),v=k("el-button"),V=k("el-popover"),T=k("el-checkbox"),z=k("el-form"),B=k("Dialog");return m(),_("div",Z,[e[31]||(e[31]=s("div",{class:"bg"},null,-1)),s("div",ee,[r(z,{class:"login-register",model:a.value,rules:R,ref_key:"formDataRef",ref:M},{default:o(()=>[e[29]||(e[29]=s("div",{class:"login-title"},"Easy云盘",-1)),r(d,{prop:"email"},{default:o(()=>[r(n,{size:"large",clearable:"",placeholder:"请输入邮箱",modelValue:a.value.email,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.email=l),modelModifiers:{trim:!0},maxLength:"150"},{prefix:o(()=>e[17]||(e[17]=[s("span",{class:"iconfont icon-account"},null,-1)])),_:1},8,["modelValue"])]),_:1}),t.value==1?(m(),b(d,{key:0,prop:"password"},{default:o(()=>[r(n,{type:"password",size:"large",placeholder:"请输入密码",modelValue:a.value.password,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.password=l),modelModifiers:{trim:!0},"show-password":""},{prefix:o(()=>e[18]||(e[18]=[s("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})):p("",!0),t.value==0||t.value==2?(m(),_("div",oe,[r(d,{prop:"emailCode"},{default:o(()=>[s("div",se,[r(n,{size:"large",placeholder:"请输入邮箱验证码",modelValue:a.value.emailCode,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.emailCode=l),modelModifiers:{trim:!0}},{prefix:o(()=>e[19]||(e[19]=[s("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),r(v,{class:"send-mail-btn",type:"primary",size:"large",onClick:S},{default:o(()=>e[20]||(e[20]=[q("获取验证码",-1)])),_:1,__:[20]})]),r(V,{placement:"left",width:500,trigger:"click"},{reference:o(()=>e[21]||(e[21]=[s("span",{class:"a-link",style:{"font-size":"14px"}},"未收到邮箱验证码？",-1)])),default:o(()=>[e[22]||(e[22]=s("div",null,[s("p",null,"1、在垃圾箱中查找邮箱验证码"),s("p",null,"2、在邮箱中头像->设置->反垃圾->白名单->设置邮件地址白名单"),s("p",null," 3、将邮箱【laoluo@wuhancoder.com】添加到白名单不知道怎么设置？ ")],-1))]),_:1,__:[22]})]),_:1}),t.value==0?(m(),b(d,{key:0,prop:"nickName"},{default:o(()=>[r(n,{size:"large",clearable:"",placeholder:"请输入昵称",modelValue:a.value.nickName,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.nickName=l),modelModifiers:{trim:!0},maxLength:"20"},{prefix:o(()=>e[23]||(e[23]=[s("span",{class:"iconfont icon-account"},null,-1)])),_:1},8,["modelValue"])]),_:1})):p("",!0),r(d,{prop:"registerPassword"},{default:o(()=>[r(n,{type:"password",size:"large",placeholder:"请输入密码",modelValue:a.value.registerPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.registerPassword=l),modelModifiers:{trim:!0},"show-password":""},{prefix:o(()=>e[24]||(e[24]=[s("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"reRegisterPassword"},{default:o(()=>[r(n,{type:"password",size:"large",placeholder:"请再次输入密码",modelValue:a.value.reRegisterPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.reRegisterPassword=l),modelModifiers:{trim:!0},"show-password":""},{prefix:o(()=>e[25]||(e[25]=[s("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})])):p("",!0),r(d,{prop:"checkCode"},{default:o(()=>[s("div",le,[r(n,{size:"large",placeholder:"请输入验证码",modelValue:a.value.checkCode,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.checkCode=l),modelModifiers:{trim:!0},onKeyup:J(h,["enter"])},{prefix:o(()=>e[26]||(e[26]=[s("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),s("img",{src:U.value,class:"check-code",onClick:e[7]||(e[7]=l=>w(0))},null,8,te)])]),_:1}),t.value==1?(m(),b(d,{key:2},{default:o(()=>[s("div",ae,[r(T,{modelValue:a.value.rememberMe,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.rememberMe=l)},{default:o(()=>e[27]||(e[27]=[q("记住我",-1)])),_:1,__:[27]},8,["modelValue"])]),s("div",re,[s("a",{href:"javascript:void(0)",class:"a-link",onClick:e[9]||(e[9]=l=>f(2))},"忘记密码？"),s("a",{href:"javascript:void(0)",class:"a-link",onClick:e[10]||(e[10]=l=>f(0))},"没有账号？")])]),_:1})):p("",!0),t.value==0?(m(),b(d,{key:3},{default:o(()=>[s("a",{href:"javascript:void(0)",class:"a-link",onClick:e[11]||(e[11]=l=>f(1))},"已有账号?")]),_:1})):p("",!0),t.value==2?(m(),b(d,{key:4},{default:o(()=>[s("a",{href:"javascript:void(0)",class:"a-link",onClick:e[12]||(e[12]=l=>f(1))},"去登录?")]),_:1})):p("",!0),r(d,null,{default:o(()=>[r(v,{type:"primary",class:"op-btn",onClick:h,size:"large"},{default:o(()=>[t.value==0?(m(),_("span",ie,"注册")):p("",!0),t.value==1?(m(),_("span",ne,"登录")):p("",!0),t.value==2?(m(),_("span",de,"重置密码")):p("",!0)]),_:1})]),_:1}),t.value==1?(m(),_("div",ue,[e[28]||(e[28]=q(" 快捷登录 ",-1)),s("img",{src:X,onClick:E})])):p("",!0)]),_:1,__:[29]},8,["model"])]),r(B,{show:C.show,title:C.title,buttons:C.buttons,width:"500px",showCancel:!1,onClose:e[16]||(e[16]=l=>C.show=!1)},{default:o(()=>[r(z,{model:y.value,rules:R,ref_key:"formData4SendMailCodeRef",ref:x,"label-width":"80px",onSubmit:e[15]||(e[15]=W(()=>{},["prevent"]))},{default:o(()=>[r(d,{label:"邮箱"},{default:o(()=>[q(Y(a.value.email),1)]),_:1}),r(d,{label:"验证码",prop:"checkCode"},{default:o(()=>[s("div",me,[r(n,{size:"large",placeholder:"请输入验证码",modelValue:y.value.checkCode,"onUpdate:modelValue":e[13]||(e[13]=l=>y.value.checkCode=l),modelModifiers:{trim:!0}},{prefix:o(()=>e[30]||(e[30]=[s("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),s("img",{src:I.value,class:"check-code",onClick:e[14]||(e[14]=l=>w(1))},null,8,pe)])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},Oe=Q(ce,[["__scopeId","data-v-d74b197d"]]);export{Oe as default};
